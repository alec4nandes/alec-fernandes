<!DOCTYPE html> <html lang="en"> <head> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-7QM5KTX0XK"></script> <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'G-7QM5KTX0XK');
</script> <meta charset="UTF-8"/> <meta http-equiv="X-UA-Compatible" content="IE=edge"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta name="type" property="og:type" content="website"/> <meta name="title" property="og:title" content="The Correct 2-Key Strategy &mdash; Alec Fernandes"/> <meta name="url" property="og:url" content="https-fern-haus-posts-correcting-the-2-key-strategy-html"/> <meta name="description" property="og:description" content="How to protect developer API keys from leaking into client-side code. &mdash; Tech &mdash; API, security, leaks, JavaScript, Webpack, Firebase"/> <meta name="image" property="og:image" content="https://fern.haus/assets/feature-images/scott-webb-lnRPKo7Lo5Q-unsplash-min.jpg"/> <!-- twitter meta tags --> <meta name="twitter:card" content="summary_large_image"/> <meta name="twitter:site" content="@alec4nandes"/> <meta name="twitter:title" content="The Correct 2-Key Strategy &mdash; Alec Fernandes"/> <meta name="twitter:description" content="How to protect developer API keys from leaking into client-side code. &mdash; Tech &mdash; API, security, leaks, JavaScript, Webpack, Firebase"/> <meta name="twitter:image" content="https://fern.haus/assets/feature-images/scott-webb-lnRPKo7Lo5Q-unsplash-min.jpg"/> <!-- end meta tags --> <title>The Correct 2-Key Strategy &mdash; Alec Fernandes</title> <link rel="icon" type="image/x-icon" href="/assets/logo/favicon.png"/> <link rel="stylesheet" href="/css/blog.css"/> </head> <body> <header> <div id="name-and-logo"> <button id="hamburger-menu-button"> <img src="/assets/hamburger-menu-icon.png" /> </button> <a href="/"> <div id="logo-container"> <img id="header-logo" src="/assets/logo/fern-haus-site-logo.png" alt="Fern Haus logo: a house wrapped with two fern branches." /> </div> <div id="blog-name"> <span>Alec</span> <span>Fernandes</span> </div> </a> </div> <div id="hamburger-menu" class="closed"> <button id="close-menu"> <img src="/assets/hamburger-menu-close-icon.png" /> </button> <h2>Menu</h2> <a href="/">Home</a> <a href="/categories">All Categories</a> <a href="/tags">All Tags</a> <a href="/about">About</a> <a href="/portfolio" target="_blank">Published Work</a> <a href="/tags/my-projects">Web Dev Projects</a> <a href="/gallery" target="_blank">Graphic Design</a> <a href="/about">Contact</a> <section class="social-icons"> <a href="https://twitter.com/alec4nandes" target="_blank"> <img class="x-icon" src="/assets/social/x.png"/> </a> <a href="https://instagram.com/alec4nandes" target="_blank"> <img class="instagram-icon" src="/assets/social/instagram.png"/> </a> <a href="https://www.tiktok.com/@alec4nandes" target="_blank"> <img class="tiktok-icon" src="/assets/social/tiktok.png"/> </a> </section> </div> </header> <main> <section id="main-content"> <div id="posts-container"> <div id="latest-post"> <div class="single-post whole-post"> <div class="post-categories"> <a class="post-category-link" href="/categories/tech"> Tech </a> </div> <div class="whole-post-image-container"> <img src="/assets/feature-images/scott-webb-lnRPKo7Lo5Q-unsplash-min.jpg" alt="key hanging from a Lego keychain holder mounted on a wall"/> </div> <p class="caption"> <em>Photo by <a href="https://unsplash.com/@scottwebb?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash" target="_blank" rel="noopener">Scott Webb</a> on <a href="https://unsplash.com/photos/red-blue-and-green-hanging-decor-lnRPKo7Lo5Q?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash" target="_blank" rel="noopener">Unsplash</a></em> </p> <h1>The Correct 2-Key Strategy</h1> <p class="subtitle"> How to protect developer API keys from leaking into client-side code. </p> <p class="date-posted"> 2024-09-03T10:31-07:00 </p> <p class="blurb"> At first I thought I found a way to protect developer API keys – or keys open to <em>localhost</em> – from leaking into client-side code. Boy, was I wrong. </p> <p> Webpack's compiler conveniently removes unused code, but I had accidentally configured my JavaScript to use both the development <em>and</em> production API keys after compiling. Setting the gatekeeping variable <em>IS_DEVELOPMENT</em> to false had no effect at build time. When I think about it now, it makes sense. JavaScript needs both API keys at runtime for the boolean to even know which one to pick <em>(duh).</em> </p> <p> I can't use a gatekeeping boolean variable to hide the development key from my client-side code. However, there is another way – although it's a bit more complex (ain't that how web development goes). Here are the steps I took to completely hide my development API keys that are open to <em>localhost:</em> </p> <ol> <li> Create two files: <em>api-key-dev.js</em> and <em>api-key-prod.js</em> (for development and production, respectively) </li> <li> Add the development and production API keys to their respective files </li> <li> Export each API key with the same variable name. Example: <pre><code><xmp>export { apiKey }</xmp></code></pre> </li> <li> Import the development API key where needed. Example for <em><u>client-file.js</u>:</em> <pre><code><xmp>import { apiKey } from "./api-key-dev.js"</xmp></code></pre> </li> <li> Create a command-line file (shell ".sh" file for Mac, or batch ".bat" file for Windows) that has these lines of code: 
<pre><code><xmp># Mac shell script replacing the development API key import with the production one:
sed -i '' 's/api-key-dev.js/api-key-prod.js/g' client-file.js

# Windows batch script version:
(Get-Content client-file.js) -replace 'api-key-dev.js', 'api-key-prod.js' | Out-File -encoding ASCII client-file.js

# bundle/deploy/publish command(s) go here:
npm run deploy

# switch the production API key import back to the development one after deployment:
sed -i '' 's/api-key-prod.js/api-key-dev.js/g' client-file.js

# Windows batch script version:
(Get-Content client-file.js) -replace 'api-key-prod.js', 'api-key-dev.js' | Out-File -encoding ASCII client-file.js</xmp></code></pre> </li> <li> Before running the above script, make sure to add <em>api-key-dev.js</em> as a line in your <em>.gitignore</em> file to prevent it from winding up on GitHub. Also, if <em>api-key-dev.js</em> exists in a public directory, make sure to prevent web clients from accessing it by updating your <em>.htaccess</em> file directly or through your hosting service's settings. For Firebase Hosting, I would add <em>**/api-key-dev.js</em> to the "ignore" array under <em>firebase.json</em> </li> </ol> <p> Now running our special script will swap out the development imports with the production ones before deployment, then switch them back afterwards, all while keeping the development API key hidden from public access. </p> <br/> </div> </div> </div> </section> <section id="sidebar" class="whole-post-sidebar"> <div id="categories-and-tags"> <a id="home-link" href="/">Go Home</a> <section class="social-icons"> <a href="https://twitter.com/alec4nandes" target="_blank"> <img class="x-icon" src="/assets/social/x.png"/> </a> <a href="https://instagram.com/alec4nandes" target="_blank"> <img class="instagram-icon" src="/assets/social/instagram.png"/> </a> <a href="https://www.tiktok.com/@alec4nandes" target="_blank"> <img class="tiktok-icon" src="/assets/social/tiktok.png"/> </a> </section> <div id="categories"> <div id="categories-sidebar-heading"> <h2>Post Categories</h2> <a class="all-categories-link" href="/categories">all categories</a> </div> <a class="category-link" href="/categories/tech" style="background-image: url('/assets/categories/tech.jpg');" > <span>Tech</span> </a> </div> <div id="tags"> <h2>Post Tags</h2> <a href="/tags">all tags</a> <ul class="tags-list"> <li> <a class="tag-link" href="/tags/api"> API </a> </li> <li> <a class="tag-link" href="/tags/security"> security </a> </li> <li> <a class="tag-link" href="/tags/leaks"> leaks </a> </li> <li> <a class="tag-link" href="/tags/javascript"> JavaScript </a> </li> <li> <a class="tag-link" href="/tags/webpack"> Webpack </a> </li> <li> <a class="tag-link" href="/tags/firebase"> Firebase </a> </li> </ul> </div> </div> </section> </main> <footer> <p> <em> &copy; Alec Fernandes <span id="current-year"></span> </em> </p> <p> <a href="/about">About</a> </p> </footer> <script>
    document.querySelector("#current-year").textContent =
        new Date().getFullYear();
</script> <script src="/src/scripts.js"></script> </body> </html>