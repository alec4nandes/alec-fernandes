<!DOCTYPE html> <html lang="en"> <head> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-7QM5KTX0XK"></script> <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'G-7QM5KTX0XK');
</script> <meta charset="UTF-8"/> <meta http-equiv="X-UA-Compatible" content="IE=edge"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta name="type" property="og:type" content="website"/> <meta name="title" property="og:title" content="Protecting API Endpoints Outside the Browser &mdash; Alec Fernandes"/> <meta name="url" property="og:url" content="https-fern-haus-posts-protecting-api-endpoints-outside-the-browser-html"/> <meta name="description" property="og:description" content="Why CORS isn't enough. &mdash; Tech &mdash; API, security, CORS, HTTP restrictions, Node.js, AWS"/> <meta name="image" property="og:image" content="https://fern.haus/assets/feature-images/kevin-ku-w7ZyuGYNpRQ-unsplash.jpg"/> <!-- twitter meta tags --> <meta name="twitter:card" content="summary_large_image"/> <meta name="twitter:site" content="@alec4nandes"/> <meta name="twitter:title" content="Protecting API Endpoints Outside the Browser &mdash; Alec Fernandes"/> <meta name="twitter:description" content="Why CORS isn't enough. &mdash; Tech &mdash; API, security, CORS, HTTP restrictions, Node.js, AWS"/> <meta name="twitter:image" content="https://fern.haus/assets/feature-images/kevin-ku-w7ZyuGYNpRQ-unsplash.jpg"/> <!-- end meta tags --> <title>Protecting API Endpoints Outside the Browser &mdash; Alec Fernandes</title> <link rel="icon" type="image/x-icon" href="/assets/logo/favicon.png"/> <link rel="stylesheet" href="/css/blog.css"/> </head> <body> <header> <div id="name-and-logo"> <button id="hamburger-menu-button"> <img src="/assets/hamburger-menu-icon.png" /> </button> <a href="/"> <div id="logo-container"> <img id="header-logo" src="/assets/logo/fern-haus-site-logo.png" alt="Fern Haus logo: a house wrapped with two fern branches." /> </div> <div id="blog-name"> <span>Alec</span> <span>Fernandes</span> </div> </a> </div> <div id="hamburger-menu" class="closed"> <button id="close-menu"> <img src="/assets/hamburger-menu-close-icon.png" /> </button> <h2>Menu</h2> <a href="/">Home</a> <a href="/categories">All Categories</a> <a href="/tags">All Tags</a> <a href="/about">About</a> <a href="/portfolio" target="_blank">Published Work</a> <a href="/tags/my-projects">Web Dev Projects</a> <a href="/gallery" target="_blank">Graphic Design</a> <a href="/about">Contact</a> <section class="social-icons"> <a href="https://twitter.com/alec4nandes" target="_blank"> <img class="x-icon" src="/assets/social/x.png"/> </a> <a href="https://instagram.com/alec4nandes" target="_blank"> <img class="instagram-icon" src="/assets/social/instagram.png"/> </a> <a href="https://www.tiktok.com/@alec4nandes" target="_blank"> <img class="tiktok-icon" src="/assets/social/tiktok.png"/> </a> </section> </div> </header> <main> <section id="main-content"> <div id="posts-container"> <div id="latest-post"> <div class="single-post whole-post"> <div class="post-categories"> <a class="post-category-link" href="/categories/tech"> Tech </a> </div> <div class="whole-post-image-container"> <img src="/assets/feature-images/kevin-ku-w7ZyuGYNpRQ-unsplash.jpg" alt="glasses sitting on an open laptop"/> </div> <p class="caption"> <em>Photo by <a target="_blank" href="https://unsplash.com/@ikukevk?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Kevin Ku</a> on <a target="_blank" href="https://unsplash.com/photos/closeup-photo-of-eyeglasses-w7ZyuGYNpRQ?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a></em> </p> <h1>Protecting API Endpoints Outside the Browser</h1> <p class="subtitle"> Why CORS isn't enough. </p> <p class="date-posted"> 2024-09-04T11:38-07:00 </p> <p class="blurb"> I built some AI APIs, and the endpoint URLs are visible in my client-side code. It's okay that these endpoints are showing, as long as only <em>my</em> website can successfully call the APIs with a valid user token. I originally set up CORS restrictions to achieve this, but after some testing I realized that Node.js scripts running outside the browser – either locally or on a server – can still make valid requests to my APIs. Why is this? </p> <p> CORS restrictions prevent a website from making requests for another site's resources, especially requests that contain sensitive user information obtained through scams like phishing. Imagine if someone was able to grab your user authentication token for accessing your database. That person then uses the token on their own website, which is coded to mess with your data using the legit client-side API endpoint. Not great, right? </p> <p> Developers can prevent these nasty forged requests thanks to CORS restrictions, but this protection only applies within the browser. This is because authentication tokens are difficult to steal outside an interactive browsing session, therefore Node scripts ignore CORS restrictions when run from a server environment or the command line. However, <strong>I still don't like that others can call my API endpoints from these "private" locations</strong>, especially if someone is able to somehow forge a legitimate request. I want only my website and its development environment to be able to receive successful responses from my endpoints. </p> <p> After some hours tinkering around, here's the solution I came up with: <strong>verify the request header's origin inside the API.</strong> I maintain an array of valid origins in the API code, which checks the incoming request headers to see if their origins are in the array. If an origin is not in the array, the API returns a <em>403: Forbidden</em> response code. It's simple, effective, and another layer of security on top of CORS and token authentication for my more sensitive APIs. Here's an example for an <em>AWS Lambda</em> function: </p> <pre><code><xmp>export const handler = async (event) => {
    const allowedOrigins = ["https://fern.haus"],
        { origin } = event.headers;
    if (!allowedOrigins.includes(origin)) {
        const response = {
            statusCode: 403,
            body: "Forbidden: Unauthorized Origin",
        };
        return response;
    }
    const response = {
        statusCode: 200,
        body: "Success!"
    };
    return response;
};</xmp></code></pre> <p> I don't need some hacker playing around with my custom AI endpoints, running up a huge bill from OpenAI at my expense. I'm sure you don't, either. ✌️ </p> <br/> </div> </div> </div> </section> <section id="sidebar" class="whole-post-sidebar"> <div id="categories-and-tags"> <a id="home-link" href="/">Go Home</a> <section class="social-icons"> <a href="https://twitter.com/alec4nandes" target="_blank"> <img class="x-icon" src="/assets/social/x.png"/> </a> <a href="https://instagram.com/alec4nandes" target="_blank"> <img class="instagram-icon" src="/assets/social/instagram.png"/> </a> <a href="https://www.tiktok.com/@alec4nandes" target="_blank"> <img class="tiktok-icon" src="/assets/social/tiktok.png"/> </a> </section> <div id="categories"> <div id="categories-sidebar-heading"> <h2>Post Categories</h2> <a class="all-categories-link" href="/categories">all categories</a> </div> <a class="category-link" href="/categories/tech" style="background-image: url('/assets/categories/tech.jpg');" > <span>Tech</span> </a> </div> <div id="tags"> <h2>Post Tags</h2> <a href="/tags">all tags</a> <ul class="tags-list"> <li> <a class="tag-link" href="/tags/api"> API </a> </li> <li> <a class="tag-link" href="/tags/security"> security </a> </li> <li> <a class="tag-link" href="/tags/cors"> CORS </a> </li> <li> <a class="tag-link" href="/tags/http-restrictions"> HTTP restrictions </a> </li> <li> <a class="tag-link" href="/tags/node-js"> Node.js </a> </li> <li> <a class="tag-link" href="/tags/aws"> AWS </a> </li> </ul> </div> </div> </section> </main> <footer> <p> <em>&copy; Alec Fernandes 2024</em> </p> <p> <a href="/about">About</a> </p> </footer> <script src="/src/scripts.js"></script> </body> </html>